import{r as t,c as s,h as i,H as e,g as a}from"./p-91596cb5.js";import{R as o,E as n,M as r,T as l,a as h,C as c,F as d,b as p,c as u,d as f,S as g}from"./p-11a0c62a.js";import{T as m,A as y,I as v}from"./p-3eddaf0f.js";import{c as b}from"./p-1a6eea35.js";import{R as w}from"./p-877d09b7.js";import{T as F}from"./p-a8d7c05f.js";const S=new class{constructor(){this.position=null,this.options=[],m(this)}show(t,s,i){this.position={x:t,y:s},this.options=i}hide(){this.position=null}reset(){this.position=null,this.options=[]}};class k{constructor(){this.shortcuts=new Map}static getInstance(){return k.instance||(k.instance=new k),k.instance}init(){this.initializeShortcuts(),document.addEventListener("keydown",this.handleKeyDown.bind(this))}initializeShortcuts(){this.registerShortcut(["KeyS"],this.handleSplit),this.registerShortcut(["Delete"],this.handleDelete),this.registerShortcut(["Backspace"],this.handleDelete),this.registerShortcut(["ctrl","Home"],this.moveClipLeft),this.registerShortcut(["Escape"],this.handleUnfocusAction)}handleKeyDown(t){const s=t.composedPath()[0];if(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement)return;const i=[t.ctrlKey?"ctrl":"",t.altKey?"alt":"",t.shiftKey?"shift":"",t.code].filter(Boolean).sort().join("+"),e=this.shortcuts.get(i);e&&(e(t),t.preventDefault())}registerShortcut(t,s){const i=t.sort().join("+");this.shortcuts.set(i,s)}handleUnfocusAction(){S.hide()}handleSplit(){return w.splitAtCurrentTime()}handleDelete(){return w.deleteAtCurrentTime()}moveClipLeft(){return w.moveClipLeft()}destroy(){document.removeEventListener("keydown",this.handleKeyDown.bind(this)),this.shortcuts.clear(),k.instance=null}}k.instance=null;const $="https://api.pexels.com/v1",U="https://api.giphy.com/v1";class _{constructor(){this.gcsBaseUrl="https://storage.googleapis.com/revot-public-object/rendly-default-files"}static getInstance(){return _.instance||(_.instance=new _),_.instance}init(t){this.pexelsApiKey=t.pexelsApiKey,this.giphyApiKey=t.giphyApiKey,t.gcsBaseUrl&&(this.gcsBaseUrl=t.gcsBaseUrl)}async getGCSImages(){try{const t={yellow:{start:1,end:8},blue:{start:9,end:16},red:{start:17,end:24},gray:{start:25,end:32},black:{start:33,end:40},white:{start:41,end:48}},s=[];for(const[i,e]of Object.entries(t))for(let t=e.start;t<=e.end;t++){const e=`${this.gcsBaseUrl}/arrows/${i}/Arrow ${t}.webp`;s.push({src:{original:e,large2x:e,large:e,medium:e,small:e,portrait:e,landscape:e,tiny:e},id:t,width:800,height:600,photographer:"GCS",photographer_url:"",photographer_id:1,avg_color:"#FFFFFF",url:e,alt:`${i} arrow ${t}`,liked:!1})}return{page:1,per_page:s.length,photos:s,next_page:""}}catch(t){return console.error("GCS画像の取得に失敗:",t),{page:1,per_page:0,photos:[],next_page:""}}}async getGCSTexts(){try{const t=[];return["alert","check","confirm","danger","need-confirmation","ng","ok","point","safety"].forEach(((s,i)=>{const e=`${this.gcsBaseUrl}/texts/${s}.webp`;t.push({src:{original:e,large2x:e,large:e,medium:e,small:e,portrait:e,landscape:e,tiny:e},id:i+1,width:800,height:600,photographer:"GCS",photographer_url:"",photographer_id:1,avg_color:"#FFFFFF",url:e,alt:s,liked:!1})})),{page:1,per_page:t.length,photos:t,next_page:""}}catch(t){return console.error("GCS texts画像の取得に失敗:",t),{page:1,per_page:0,photos:[],next_page:""}}}async getGCSShapes(){try{const t=["yellow","blue","red","gray","black","white"],s=["Ellipse","Group","Polygon","Rectangle"],i=[];let e=1;for(const a of t)for(const t of s){const s=`${this.gcsBaseUrl}/shapes/${a}/${t}.webp`;i.push({src:{original:s,large2x:s,large:s,medium:s,small:s,portrait:s,landscape:s,tiny:s},id:e++,width:800,height:600,photographer:"GCS",photographer_url:"",photographer_id:1,avg_color:"#FFFFFF",url:s,alt:`${a} ${t.toLowerCase()}`,liked:!1})}return{page:1,per_page:i.length,photos:i,next_page:""}}catch(t){return console.error("GCS shapes画像の取得に失敗:",t),{page:1,per_page:0,photos:[],next_page:""}}}hasApiKeys(){return!!this.pexelsApiKey&&!!this.giphyApiKey}getCurratedImages(){return this.pexelsFetcher(`${$}/curated?per_page=14`)}getCurratedVideos(){return this.pexelsFetcher(`${$}/videos/popular?per_page=14`)}getCurratedGifs(){return this.giphyFetcher(`${U}/gifs/trending?rating=g`)}getCurratedStickers(){return this.giphyFetcher(`${U}/stickers/trending?rating=g`)}searchImages(t){return t?this.pexelsFetcher(`${$}/search?query=${t}&per_page=14`):this.getCurratedImages()}searchVideos(t){return t?this.pexelsFetcher(`${$}/videos/search?query=${t}&per_page=14`):this.getCurratedVideos()}searchGifs(t){return t?this.giphyFetcher(`${U}/gifs/search?q=${t}`):this.getCurratedGifs()}searchStickers(t){return t?this.giphyFetcher(`${U}/stickers/search?q=${t}`):this.getCurratedStickers()}pexelsFetcher(t){return fetch(t,{headers:{Authorization:`${this.pexelsApiKey}`,"Content-Type":"application/json"}}).then((t=>t.json()))}giphyFetcher(t){return fetch(`${t}&api_key=${this.giphyApiKey}&limit=14`).then((t=>t.json()))}destroy(){this.pexelsApiKey=void 0,this.giphyApiKey=void 0,_.instance=null}}function C(t,s){return t.reduce(((t,i)=>(t[i[s]]=i,t)),{})}_.instance=null;const x=(t,s,i)=>{if(!i){const i=o.layers[s].transitionIds.find((s=>{const i=o.transitions[s];return i.startClipId===t||i.endClipId===t}));if(i){const t=n.getInstance().getTimeline().getLayerById(s);null==t||t.removeTransition(i)}}};function I(t){return Number(t.toFixed(3))}function T(t){var s,i;const e=null!==(i=null===(s=w.getLayerById(t))||void 0===s?void 0:s.clipsIds)&&void 0!==i?i:[];for(let s=0;s<e.length;s++){const i=e[s-1],a=e[s],n=e[s+1],r=w.getClipById(a);if(null==r)return;let l=!1,h=!1;const c=I(1/w.getFps());if(null!=i){const t=w.getClipById(i);if(null==t)return;l=I(Math.abs(r.getLeftBound()-t.getRightBound()))<c}if(null!=n){const t=w.getClipById(n);if(null==t)return;h=I(Math.abs(t.getLeftBound()-r.getRightBound()))<c}x(a,t,l||h),o.updateClip(a,{hasPredecessor:l,hasSuccessor:h})}}const P=[{family:"Roboto",cssUrl:"https://fonts.googleapis.com/css2?family=Roboto&display=swap"},{family:"Open Sans",cssUrl:"https://fonts.googleapis.com/css2?family=Open+Sans&display=swap"},{family:"Montserrat",cssUrl:"https://fonts.googleapis.com/css2?family=Montserrat&display=swap"},{family:"Poppins",cssUrl:"https://fonts.googleapis.com/css2?family=Poppins&display=swap"},{family:"Lato",cssUrl:"https://fonts.googleapis.com/css2?family=Lato&display=swap"},{family:"Oswald",cssUrl:"https://fonts.googleapis.com/css2?family=Oswald&display=swap"},{family:"Rubik",cssUrl:"https://fonts.googleapis.com/css2?family=Rubik&display=swap"},{family:"Ubuntu",cssUrl:"https://fonts.googleapis.com/css2?family=Ubuntu&display=swap"},{family:"PT Sans",cssUrl:"https://fonts.googleapis.com/css2?family=PT+Sans&display=swap"},{family:"Kanit",cssUrl:"https://fonts.googleapis.com/css2?family=Kanit&display=swap"},{family:"Lora",cssUrl:"https://fonts.googleapis.com/css2?family=Lora&display=swap"},{family:"Dancing Script",cssUrl:"https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap"},{family:"Bangers",cssUrl:"https://fonts.googleapis.com/css2?family=Bangers&display=swap"},{family:"Noto Sans JP",cssUrl:"https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap"}],j=new class{constructor(){this.handleReady=()=>{const t=n.getInstance().getTimeline(),s=n.getInstance().getDisplay(),i=s.getResolution(),e=Object.values(n.getInstance().getLibrary().media).reduce(((t,s)=>{const i={id:s.getId(),thumbnail:s.thumbnail,type:s.type,filename:s.filename,duration:s.duration,status:r.READY};return t[i.id]=i,t}),{}),a=t.getClips().reduce(((t,s)=>{const i={id:s.id,type:s.getType(),startTime:s.getStartTime(),leftTrim:s.getLeftTrim(),rightTrim:s.getRightTrim(),duration:s.getDuration(),trimmedDuration:s.getTrimmedDuration(),mediaDataId:s.getMediaId(),text:s instanceof l?s.text:""};return t[i.id]=i,t}),{}),h=Object.values(t.layers).reduce(((t,s)=>{const i={id:s.id,clipsIds:s.clipsIds,transitionIds:s.transitions.map((t=>t.id))};return t[i.id]=i,t}),{}),c=Object.values(t.layers).map((t=>Object.values(t.transitions))).flat().reduce(((t,s)=>{const i={id:s.id,startClipId:s.startClip.id,endClipId:s.endClip.id,inDuration:s.inDuration,outDuration:s.outDuration};return t[i.id]=i,t}),{}),d=t.getClips().reduce(((t,s)=>{const i=s.style&&Object.keys(s.style).length>0?s.style.serialize():void 0;return t[s.id]=i,t}),{});y.setSelectedTransitionId(null),o.setIsPlaying(!1),o.setCurrentTime(t.currentTime),o.setDisplayResolution(i[0],i[1]),o.setDisplayBackgroundColor(s.getBackgroundColor()),o.setMedia(e),o.setClips(a),o.setLayers(h),o.setLayersOrder(t.layersOrder),o.setTransitions(c),o.setStyles(d),o.setUpdateTimestamp(Date.now()),o.updateTimelineDuration(),o.layersOrder.forEach((t=>{T(t)}))},this.handlePlaying=t=>{o.setIsPlaying(t.isPlaying)},this.handleTime=t=>{const s=w.getEngine().getTimeline().getFitDuration();if(t>=s&&o.isPlaying)return w.pause(),void w.seek(s);o.setCurrentTime(t)},this.handleBackgroundUpdated=t=>{o.setDisplayBackgroundColor(t.backgroundColor)},this.handleResolutionUpdated=t=>{o.setDisplayResolution(t.width,t.height)},this.handleAddTransition=t=>{const s=n.getInstance().getTimeline().getLayerById(t.layerId);if(!s)return;const i=s.transitions.find((s=>s.id===t.transitionId));i&&(o.addTransition(i.serialize()),o.updateLayer(s.id,{transitionIds:[...o.layers[s.id].transitionIds,i.id]}))},this.handleRemoveTransition=t=>{y.setSelectedTransitionId(null),o.deleteTransition(t.transitionId,t.layerId)},this.handleLayerUpdated=t=>{var s;const i=w.getLayerById(t.layerId);i&&(o.updateLayer(i.id,{clipsIds:i.clipsIds,transitionIds:i.transitions.map((t=>t.id))}),0===(null===(s=null==i?void 0:i.clipsIds)||void 0===s?void 0:s.length)&&w.deleteLayer(t.layerId))},this.handleLayerAdded=t=>{const s=n.getInstance().getTimeline(),i=s.layers[t.layerId];i&&(o.addLayer({id:i.id,clipsIds:i.clipsIds,transitionIds:i.transitions.map((t=>t.id))}),o.setLayersOrder(s.layersOrder))},this.handleLayerRemoved=t=>{o.deleteLayer(t.layerId)},this.handleLayersOrderUpdated=()=>{o.setLayersOrder(n.getInstance().getTimeline().layersOrder)},this.handleClipUpdated=t=>{const s=n.getInstance().getClipById(t.clipId);s&&o.updateClip(t.clipId,{startTime:s.getStartTime(),duration:s.getDuration(),leftTrim:s.getLeftTrim(),rightTrim:s.getRightTrim(),trimmedDuration:s.getTrimmedDuration()})},this.handleClipStyleUpdated=t=>{o.updateStyles(t.clipId,{[t.property]:t.value})},this.handleClipFilterAdded=t=>{o.addFilter(t.clipId,{id:t.filterId,sourceId:t.sourceId})},this.handleClipFilterRemoved=t=>{o.deleteFilter(t.clipId,t.filterId)},this.handleClipEffectAdded=t=>{o.addEffect(t.clipId,{id:t.effectId,sourceId:t.sourceId})},this.handleClipEffectRemoved=t=>{o.deleteEffect(t.clipId,t.effectId)},this.handleClipUpdatedText=t=>{o.updateClip(t.clipId,{text:t.text})},this.handleClipAdded=t=>{var s,i;const e=n.getInstance().getTimeline().getClipById(t.clipId);if(!e)return;e instanceof l&&e.style.setBackgroundColor("#0B2A43");const a=n.getInstance().getClipById(t.clipId);o.setClip({id:e.id,type:e.type,text:e instanceof l?e.text:"",startTime:e.getStartTime(),leftTrim:e.getLeftTrim(),rightTrim:e.getRightTrim(),duration:e.getDuration(),trimmedDuration:e.getTrimmedDuration(),mediaDataId:e.getMediaId()});const r=null===(i=null===(s=null==a?void 0:a.style)||void 0===s?void 0:s.serialize)||void 0===i?void 0:i.call(s);r&&o.updateStyles(e.id,r),o.updateTimelineDuration()},this.handleClipRemoved=t=>{var s;t.clipId===y.selectedClipId&&y.setSelectedClipId(null),o.deleteClip(t.clipId,t.layerId);const i=o.layers[t.layerId];0===(null===(s=null==i?void 0:i.clipsIds)||void 0===s?void 0:s.length)?w.deleteLayer(t.layerId):T(t.layerId)},this.handleLibraryAdded=t=>{const s=n.getInstance().getLibrary().getMediaById(t.mediaDataId);null!=s&&o.addMedia({id:s.getId(),thumbnail:s.thumbnail,type:s.type,filename:s.filename,duration:s.duration,status:r.LOADING})},this.handleLibraryRemoved=t=>{o.deleteMedia(t.mediaDataId)},this.handleLibraryMediaUpdated=t=>{"ready"===t.status&&this.handleLibraryMediaReplaced(t)},this.handleLibraryMediaReplaced=t=>{const s=w.getMediaById(t.mediaDataId);null!=s&&o.addMedia({id:s.getId(),thumbnail:s.thumbnail,type:s.type,filename:s.filename,duration:s.duration,status:r.READY})},this.handleLibraryError=t=>{console.error("Library Error:",t)},this.handleClipError=t=>{console.error("Clip Error:",t)}}async init(t){try{this.setupEventListeners(),y.setTitlesPath(t.titlesPath),y.setSubtitleStylesPath(t.subtitlesStylesPath),await Promise.all(P.map((async({family:t,cssUrl:s})=>n.getInstance().getFontRegistry().loadFromCssUrl(t,s))));const s=t.transitionsPath,i=t.filtersPath,e=t.effectsPath;fetch(s+"transitions.json").then((t=>t.json())).then((t=>{const i=t.transitions.map((t=>({id:t.id,label:t.name,thumbnailUrl:s+t.path+"thumbnail.webp",videoPreviewUrl:s+t.path+"preview.mp4",shaderUrl:s+t.path+"shader.glsl"})));y.setTransitions(C(i,"id"))})),fetch(i+"filters.json").then((t=>t.json())).then((t=>{const s=t.filters.map((t=>({id:t.id,label:t.name,thumbnailUrl:i+t.path+"thumbnail.webp",lutUrl:i+t.path+"lut.png"})));y.setFilters(C(s,"id"))})),fetch(e+"effects.json").then((t=>t.json())).then((t=>{const s=t.effects.map((t=>({id:t.id,label:t.name,thumbnailUrl:e+t.path+"thumbnail.webp",videoPreviewUrl:e+t.path+"preview.mp4",shaderUrl:e+t.path+"shader.glsl"})));y.setEffects(C(s,"id"))}))}finally{y.setIsLoading(!1)}window.engine=n.getInstance()}setupEventListeners(){const t=n.getInstance().events;t.on(h.PLAYING,this.handlePlaying),t.on(h.TIME,this.handleTime),t.on(h.READY,this.handleReady),t.on(h.DISPLAY_BACKGROUND_UPDATED,this.handleBackgroundUpdated),t.on(h.DISPLAY_RESOLUTION_UPDATED,this.handleResolutionUpdated),t.on(h.LAYER_ADDED,this.handleLayerAdded),t.on(h.LAYER_REMOVED,this.handleLayerRemoved),t.on(h.LAYER_UPDATED,this.handleLayerUpdated),t.on(h.LAYERS_ORDER_UPDATED,this.handleLayersOrderUpdated),t.on(h.TRANSITION_ADDED,this.handleAddTransition),t.on(h.TRANSITION_REMOVED,this.handleRemoveTransition),t.on(h.CLIP_ADDED,this.handleClipAdded),t.on(h.CLIP_REMOVED,this.handleClipRemoved),t.on(h.CLIP_UPDATED,this.handleClipUpdated),t.on(h.CLIP_UPDATED_TEXT,this.handleClipUpdatedText),t.on(h.CLIP_STYLE_UPDATED,this.handleClipStyleUpdated),t.on(h.CLIP_EFFECT_ADDED,this.handleClipEffectAdded),t.on(h.CLIP_EFFECT_REMOVED,this.handleClipEffectRemoved),t.on(h.CLIP_FILTER_ADDED,this.handleClipFilterAdded),t.on(h.CLIP_FILTER_REMOVED,this.handleClipFilterRemoved),t.on(h.CLIP_ERROR,this.handleClipError),t.on(h.LIBRARY_ADDED,this.handleLibraryAdded),t.on(h.LIBRARY_REMOVED,this.handleLibraryRemoved),t.on(h.LIBRARY_ERROR,this.handleLibraryError),t.on(h.LIBRARY_MEDIA_UPDATED,this.handleLibraryMediaUpdated),t.on(h.LIBRARY_REPLACED,this.handleLibraryMediaReplaced)}destroy(){n.getInstance().events.removeAllListeners()}};function D(){return document.querySelector("rendley-video-editor")}function R(){var t;return null===(t=D())||void 0===t?void 0:t.shadowRoot}function E(){return R().getElementById(c)}const G=new class{constructor(){this.activeItemKey=window.innerWidth<768?null:"stock",m(this)}setActiveItemKey(t){this.activeItemKey=t}reset(){this.activeItemKey=null}},L=new class{constructor(){this.resolution=[window.innerWidth,window.innerHeight],this.canvasResolution=[0,0],m(this)}setResolution(t){this.resolution=t}setCanvasResolution(t){this.canvasResolution=t}reset(){this.resolution=[window.innerWidth,window.innerHeight],this.canvasResolution=[0,0]}},A=class{constructor(i){t(this,i),this.onReady=s(this,"onReady",7),this.onError=s(this,"onError",7),this.onRenderSuccess=s(this,"onRenderSuccess",7),this.onRenderError=s(this,"onRenderError",7),this.theme=y.theme,this.licensename=void 0,this.licensekey=void 0,this.pexelsapikey=void 0,this.giphyapikey=void 0,this.filtersPath=d,this.effectsPath=p,this.transitionsPath=u,this.titlesPath=f,this.subtitlesStylesPath=g,this.isLoading=y.isLoading,this.isRendering=y.isRendering}componentWillLoad(){this.pexelsapikey&&this.giphyapikey&&_.getInstance().init({pexelsApiKey:this.pexelsapikey,giphyApiKey:this.giphyapikey}),k.getInstance().init(),y.setTheme(this.theme),this.disposeAutorun=v((()=>{var t,s,i;this.isLoading=y.isLoading,this.isRendering=y.isRendering;const e=o.render.blobUrl,a=o.render.error;e&&(null===(t=this.onRenderSuccess)||void 0===t||t.emit(e)),a&&(null===(s=this.onRenderError)||void 0===s||s.emit(a)),null===(i=this.el)||void 0===i||i.setAttribute("theme",y.theme)}))}componentDidLoad(){this.init()}disconnectedCallback(){this.destroy()}async destroy(){var t;null===(t=this.disposeAutorun)||void 0===t||t.call(this),k.getInstance().destroy(),_.getInstance().destroy(),j.destroy(),await n.getInstance().destroy(!0),y.reset(),S.reset(),o.reset(),G.reset(),F.reset(),L.reset()}async init(){var t,s,i,e,a,o,n;try{let n;this.licensename&&this.licensekey&&(n={licenseName:this.licensename,licenseKey:this.licensekey}),await w.init({display:{width:1920,height:1080,backgroundColor:"#FFFFFF",view:E()},license:n}),await j.init({filtersPath:null!==(t=this.filtersPath)&&void 0!==t?t:"",effectsPath:null!==(s=this.effectsPath)&&void 0!==s?s:"",transitionsPath:null!==(i=this.transitionsPath)&&void 0!==i?i:"",titlesPath:null!==(e=this.titlesPath)&&void 0!==e?e:"",subtitlesStylesPath:null!==(a=this.subtitlesStylesPath)&&void 0!==a?a:""}),null===(o=this.onReady)||void 0===o||o.emit()}catch(t){return null===(n=this.onError)||void 0===n||n.emit(t),null}}async getElement(){return Promise.resolve(this.el)}async getEngine(){return n}async handleDropFiles(t){const s=n.getInstance().getLibrary(),i=[];for(let e=0;e<t.length;e++)i.push(s.addMedia(t[e]));await Promise.all(i)}render(){return i(e,{key:"f1dd25bceaae89261248afb473818ab259bbd984"},i("div",{key:"ecf98b4b0f15d4c10a5e5fab123584075517930d",class:b("relative w-ful h-full")},this.isLoading&&i("ve-loading-layout",{key:"9fb73c19fe775eba03112019bc8bf3f7884799d9"}),this.isRendering&&i("ve-rendering-layout",{key:"59f286597653ab2d94ffe7e09ca528ffc9350fea"}),i("ve-layout",{key:"a50482294ccc873a1ca68df78a3664d1ccb4aa6c",onDropFiles:this.handleDropFiles},i("ve-composition",{key:"8c07a2cfcc8ee002736bf9c6667cff7de84ccaee",slot:"rendley-container"}),i("ve-timeline",{key:"c217ccdc0bdc2287bef07e55fbcfbe970b7f0982",slot:"timeline"})),i("ve-context-menu",{key:"3327458ffc6648d3a788dbf8feee85d5be0a0030"})))}get el(){return a(this)}};export{S as C,A as R,G as S,L as W,R as a,E as b,_ as c,D as g,T as u}